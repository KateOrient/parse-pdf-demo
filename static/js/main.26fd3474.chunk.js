(window["webpackJsonpreact-pdf-test"]=window["webpackJsonpreact-pdf-test"]||[]).push([[0],{100:function(e,t,a){},101:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),i=a(38),r=a.n(i),s=a(39),l=a(48),c=a(40),d=a(41),p=a(49),g=a(42),u=a(50),m=a(18),f=(a(99),a(21)),h=a.n(f),x=a(2),b=a.n(x);var v=function(e){var t=e.pageIndex,a=e.onPageRenderSuccess;return o.a.createElement(m.Page,{className:"pdf-page",pageNumber:t,renderAnnotationLayer:!0,renderInteractiveForms:!0,renderTextLayer:!0,onRenderSuccess:a,customTextRenderer:function(e){e.height,e.width,e.transform,e.scale,e.page;return e.str}})},y=a(43),N=a.n(y),P=a(44),E=a.n(P),B=a(45),w=a.n(B),O=a(46),D=a.n(O),S=a(47),I=a.n(S),_=[{title:"Default sample",file:h.a},{title:"STEM Sample",file:N.a},{title:"Det is Berlin",file:E.a},{title:"Book catalog",file:w.a},{title:"PDF/UA Reference",file:D.a},{title:"Nutshell",file:I.a}],M=0;var T=function(e){var t;function a(t){return function(){M=b.a.findIndex(_,t),e.onUploadSampleFile(t.file)}}return o.a.createElement("header",{className:"App-header"},o.a.createElement("section",{className:"app-btn-pane"},b.a.map(_,function(t,n){return o.a.createElement("button",{onClick:a(t),className:"app-btn",key:n,disabled:n===M||e.loading},t.title)}),o.a.createElement("button",{onClick:function(){M=null,t.click()},className:"app-btn",disabled:e.loading},"Upload other pdf"),o.a.createElement("input",{type:"file",onChange:e.onUploadFile,ref:function(e){t=e},style:{display:"none"}})),o.a.createElement("div",{className:"pdf-loading"},e.loading?"Loading pdf...":""))};a(100);function j(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}m.pdfjs.GlobalWorkerOptions.workerSrc="pdf.worker.js";var k={containerRef:null,activeTagName:null,tagPath:null},R=0,C=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(p.a)(this,Object(g.a)(t).call(this,e))).getBoundingBoxesFromTree=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.a.cloneDeep(a.state.structureTree),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(t instanceof Array)t.forEach(function(n){n&&a.getBoundingBoxesFromTree(e,n,t,o)});else if(t instanceof Object)if(t.hasOwnProperty("mcid")&&t.hasOwnProperty("pageIndex")){var i=null;i=a.getBoundingBoxForChildren(n,t.pageIndex),e.hasOwnProperty(t.pageIndex)||(e[t.pageIndex]=[]),e[t.pageIndex].push({mcid:t.mcid,el_bbox:a.state.bboxByPage[t.pageIndex][t.mcid],bbox:i,path:o})}else if(t.hasOwnProperty("rect")&&t.hasOwnProperty("pageIndex")){e.hasOwnProperty(t.pageIndex)||(e[t.pageIndex]=[]);var r={x:Math.min(t.rect[0],t.rect[2]),y:Math.min(t.rect[1],t.rect[3]),width:Math.abs(t.rect[0]-t.rect[2]),height:Math.abs(t.rect[1]-t.rect[3])};e[t.pageIndex].push({pageIndex:t.pageIndex,el_bbox:r,bbox:r,path:o})}else t.hasOwnProperty("name")&&t.hasOwnProperty("children")&&a.getBoundingBoxesFromTree(e,t.children,t,[].concat(Object(l.a)(o),[t.name]))},a.uniteBoundingBoxes=function(e,t){return b.a.isNil(e)?t:b.a.isNil(t)?b.a.cloneDeep(e):{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),width:Math.max(e.x+e.width,t.x+t.width)-Math.min(e.x,t.x),height:Math.max(e.y+e.height,t.y+t.height)-Math.min(e.y,t.y)}},a.getBoundingBoxForChildren=function(e,t){if(e instanceof Array){var n=null;return e.map(function(e){return n=a.uniteBoundingBoxes(a.getBoundingBoxForChildren(e,t),n)}),n}if(e instanceof Object){if(e.hasOwnProperty("mcid")&&e.hasOwnProperty("pageIndex")){var o=a.state.bboxByPage[e.pageIndex][e.mcid];return b.a.isNil(o)||b.a.isNaN(o.x)||b.a.isNaN(o.y)||b.a.isNaN(o.width)||b.a.isNaN(o.height)||e.pageIndex!==t?null:o}var i=null;return Object.keys(e).map(function(n){i=a.uniteBoundingBoxes(a.getBoundingBoxForChildren(e[n],t),i)}),i}},a.onDocumentLoadSuccess=function(e){console.log(e);var t=e._pdfInfo.structureTree||{};e.getMetadata().then(function(e){var n=e.info,o=(e.metadata,e.contentDispositionFilename,n.RoleMap),i=n.ClassMap,r=n.Title||a.state.pdf.name;a.setState({title:r,structureTree:t,roleMap:o||{},classMap:i||{}})});var n=e.numPages;a.setState({numPages:n})},a.onPageRenderSuccess=function(e){e.getOperatorList().then(function(t){var n=t.argsArray[t.argsArray.length-1],o=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?j(a,!0).forEach(function(t){Object(s.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):j(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},a.state.bboxByPage);o[e.pageIndex]=n||{};var i=document.getElementsByTagName("canvas")[e.pageIndex].getBoundingClientRect(),r=document.createElement("canvas");r.style.top=i.y+"px",r.style.left=i.x+"px",r.style.height=i.height+"px",r.style.width=i.width+"px",r.height=i.height,r.width=i.width,r.style.position="absolute",r.id="bboxCanvas"+e.pageIndex,r.setAttribute("data-page",e.pageIndex),k.containerRef.appendChild(r);var l=r.getContext("2d");l.translate(0,i.height),l.scale(1,-1),r.onmousemove=a.onBboxMove,++R===a.state.numPages?a.setState({loading:!1,bboxByPage:o},function(){var e={};a.getBoundingBoxesFromTree(e),console.log(e),a.setState({tagsData:e})}):a.state.bboxByPage=o})},a.onBboxMove=function(e){var t=e.target,n=t.getBoundingClientRect(),o=e.clientX-n.left,i=t.offsetHeight-(e.clientY-n.top),r=t.getContext("2d"),s=t.getAttribute("data-page"),l=a.state.tagsData[s];r.clearRect(0,0,t.offsetWidth,t.offsetHeight),r.strokeStyle="red";var c=b.a.find(l,function(e){return o>=e.el_bbox.x&&o<=e.el_bbox.x+e.el_bbox.width&&i>=e.el_bbox.y&&i<=e.el_bbox.y+e.el_bbox.height});c?(r.strokeRect(c.bbox.x,c.bbox.y,c.bbox.width,c.bbox.height),a.fillDocData(c.path[c.path.length-1],c.path.join(" -> "),c.mcid)):a.fillDocData()},a.fillDocData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="None";e?(k.activeTagName.textContent=e,k.tagPath.classList.remove("_empty")):(k.activeTagName.textContent=n,k.tagPath.classList.add("_empty")),t?(k.tagPath.textContent=t,k.activeTagName.classList.remove("_empty")):(k.tagPath.textContent=n,k.activeTagName.classList.add("_empty")),Number.isInteger(a)?(k.mcid.textContent=a,k.mcid.classList.remove("_empty")):(k.mcid.textContent=n,k.mcid.classList.add("_empty"))},a.onUploadFile=function(e){R=0,a.setState({loading:!0,bboxByPage:{}});var t=e.target.files[0],n=new FileReader;n.onload=a.onUploadEnd,t?n.readAsArrayBuffer(t):a.setState({pdf:null,loading:!1})},a.onUploadSampleFile=function(e){R=0,a.setState({loading:!0,bboxByPage:{}}),a.onUploadEnd(e)},a.onUploadEnd=function(e){console.log(e),document.getElementById("container").innerHTML="",a.setState({numPages:null,pageNumber:1,pdf:e})},a.onError=function(e){a.setState({error:e.message,loading:!1})},a.state={numPages:null,pageNumber:1,pdf:h.a,title:h.a.name,boundingBoxes:null,renderedPages:0,error:null,structureTree:{},roleMap:{},classMap:{},loading:!0,bboxByPage:{},tagsData:null},a}return Object(u.a)(t,e),Object(d.a)(t,[{key:"componentDidUpdate",value:function(){this.state.renderedPages===this.state.numPages&&(console.log("BBoxes",this.state.boundingBoxes),this.setState({renderedPages:0}))}},{key:"getPages",value:function(){for(var e=[],t=this.state.numPages,a=1;a<=t;a++)e.push(o.a.createElement(v,{pageIndex:a,onPageRenderSuccess:this.onPageRenderSuccess,key:"page-"+a}));return e}},{key:"setRef",value:function(e){return function(t){k[e]=t}}},{key:"render",value:function(){var e=this.state,t=e.numPages,a=e.title,n=e.loading;return o.a.createElement("div",{className:"App ".concat(n?"_loading":"")},o.a.createElement(T,{onUploadFile:this.onUploadFile,onUploadSampleFile:this.onUploadSampleFile,loading:n}),o.a.createElement("main",{className:"app-main-body"},o.a.createElement("div",{className:"pdf-wrapper"},o.a.createElement(m.Document,{file:this.state.pdf,onLoadSuccess:this.onDocumentLoadSuccess,options:{cMapUrl:"//cdn.jsdelivr.net/npm/pdfjs-dist@".concat(m.pdfjs.version,"/cmaps/"),cMapPacked:!0},onLoadError:this.onError,error:o.a.createElement("div",{className:"error-msg"},this.state.error)},this.getPages()))),o.a.createElement("div",{id:"container",ref:this.setRef("containerRef")}),o.a.createElement("div",{id:"tagInfo"},o.a.createElement("div",{className:"tag-prop"},o.a.createElement("div",{className:"tag-info-title"},"Document title"),o.a.createElement("div",{ref:this.setRef("activeTagName"),className:a?"":"_empty"},a||"None")),o.a.createElement("div",{className:"tag-prop"},o.a.createElement("div",{className:"tag-info-title"},"Number of pages"),o.a.createElement("div",{ref:this.setRef("activeTagName")},t)),o.a.createElement("div",{className:"tag-prop"},o.a.createElement("div",{className:"tag-info-title"},"Tag name"),o.a.createElement("div",{ref:this.setRef("activeTagName"),className:"_empty"},"None")),o.a.createElement("div",{className:"tag-prop"},o.a.createElement("div",{className:"tag-info-title"},"Tree path"),o.a.createElement("div",{ref:this.setRef("tagPath"),className:"_empty"},"None")),o.a.createElement("div",{className:"tag-prop"},o.a.createElement("div",{className:"tag-info-title"},"MCID"),o.a.createElement("div",{ref:this.setRef("mcid"),className:"_empty"},"None"))))}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(C,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},21:function(e,t,a){e.exports=a.p+"static/media/Default_sample.a5053dd1.pdf"},23:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=23},43:function(e,t,a){e.exports=a.p+"static/media/STEM_Sample.6e4e83bb.pdf"},44:function(e,t,a){e.exports=a.p+"static/media/Det_is_Berlin.ba02e324.pdf"},45:function(e,t,a){e.exports=a.p+"static/media/Book_catalog.abc38450.pdf"},46:function(e,t,a){e.exports=a.p+"static/media/PDFUA-Reference-03_(Danish_Association-event).dddd5405.pdf"},47:function(e,t,a){e.exports=a.p+"static/media/Nutshell.4d676eff.pdf"},51:function(e,t,a){e.exports=a(101)},59:function(e,t){},61:function(e,t){},62:function(e,t){},63:function(e,t){},64:function(e,t){}},[[51,1,2]]]);
//# sourceMappingURL=main.26fd3474.chunk.js.map